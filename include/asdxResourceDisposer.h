//-----------------------------------------------------------------------------
// File : asdxResourceDisposer.h
// Desc : Resource Disposer.
// Copyright(c) Project Asura. All right reserved.
//-----------------------------------------------------------------------------
#pragma once

//-----------------------------------------------------------------------------
// Includes
//-----------------------------------------------------------------------------
#include <list>
#include <mutex>
#include <d3d12.h>
#include <asdxRef.h>


namespace asdx {

///////////////////////////////////////////////////////////////////////////////
// ResourceDisposer class
///////////////////////////////////////////////////////////////////////////////
class ResourceDisposer
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    ResourceDisposer();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~ResourceDisposer();

    //-------------------------------------------------------------------------
    //! @brief      リソースを登録します.
    //!
    //! @param[in]      pResource       登録するリソース.
    //-------------------------------------------------------------------------
    void Add(ID3D12Resource*& pResource);

    //-------------------------------------------------------------------------
    //! @brief      フレーム同期し，遅延解放を実行します.
    //-------------------------------------------------------------------------
    void FrameSync();

    //-------------------------------------------------------------------------
    //! @brief      強制破棄を実行します.
    //-------------------------------------------------------------------------
    void Clear();

private:
    ///////////////////////////////////////////////////////////////////////////
    // Item structure
    ///////////////////////////////////////////////////////////////////////////
    struct Item
    {
        ID3D12Resource*     pResource;
        uint32_t            LifeTime;
    };

    //=========================================================================
    // private variables.
    //=========================================================================
    std::list<Item>         m_List;
    std::recursive_mutex    m_Mutex;

    //=========================================================================
    // private methods.
    //=========================================================================
    /* NOTHING */
};

} // namespace asdx